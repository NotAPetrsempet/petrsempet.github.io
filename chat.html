<title>Спроси у мага</title>
<body style="background-color: lightgray;">
  
  <div style="height: 90px; background-color: white; position: fixed; bottom: 0px; left: 0px; word-break: auto;" id="block"><input id="msg" style="word-break: auto; font-size: 14px; padding:10px; border-radius: 10px; width: 300px;" placeholder="Введите сообщение..."><button style="background-color: lightgreen; left-padding: 10px; height: 40px; border-radius: 10px;" onclick="send()">Отправить</button></div>
<script>
  var name = "";
  block.style.width = window.innerWidth+"px";
  var http = http = new XMLHttpRequest();
http.open('GET', 'https://jsonip.com', true);
  var ip ="человек";
  http.onreadystatechange = function(){
    if (this.status == 200 && this.readyState == 4){
  ip = JSON.parse(http.responseText).ip;
  document.body.innerHTML += '<div style="background-color: white; border-radius: 10px; word-break: auto; width: 200px;"><p style="padding: 5px;">Привет, '+ip+'! Меня зовут Маг. А как тебя зовут?</p></div>';
  
    }
  }
  http.send();
  var last = "";
  var check_name = true;
  function send(){
    var isName = false;
    if (msg.value == ''){return;}
    var text = "";
    if (check_name){
    if (msg.value.toLowerCase().indexOf('меня зовут') != -1){
    name = msg.value.substring(msg.value.toLowerCase().indexOf('меня зовут')+11);
      check_name = false;
      text = "Приятно познакомится, "+name+"! Ты можешь задавать мне абсолютно любые вопросы и я на них обязательно отвечу!";
      isName = true;
    }else{
      text = 'Всё таки, напиши, пожалуйста, своё имя в формате "Меня зовут (имя)"';
    
    }
    }else{
    if (last == msg.value){
        text = "Давай другое уже!";
    }else if (msg.value.toLowerCase().indexOf('когда') != -1){
      var texts = ["Сегодня","Завтра", "Не знаю","Скоро, готовься!","В "+Math.floor(Math.random()*(23-0+1))+" ч. "+Math.floor(Math.random()*(59-0+1))+" мин.","Через "+Math.floor(Math.random()*(23-0+1))+" ч. "+Math.floor(Math.random()*(59-0+1))+" мин.", "В следующем году", "На следующей неделе", "В этом месяце"];
      text = texts[Math.floor(Math.random()*texts.length)];
    }else if (msg.value.toLowerCase().indexOf('какой') != -1){
      var texts = ["Красивый","Отличный", "Хороший","Добрый","Красный","Голубой", "Жёлтый", "Чёткий", "Прекрасный"];
      text = texts[Math.floor(Math.random()*texts.length)];
    }else if (msg.value.toLowerCase().indexOf('кто я') != -1){
      text = '<img width="154" height="180" src="https://memepedia.ru/wp-content/uploads/2020/01/hto-ja.png">';
    }
    }
  document.body.innerHTML += '<div style="margin-right: 0px; margin-left: auto; background-color: rgb(220, 248, 198); border-radius: 10px; word-break: auto; width: 200px;" ><p style="padding: 5px;">'+msg.value+'</p></div>';
    last = msg.value;
    msg.value = "";
  if (Math.floor(Math.random()*(100-0+1)) >70 & name != "" & !isName){
      text = name + ', '+text.toLowerCase();
      }    
  document.body.innerHTML += '<div style="background-color: white; border-radius: 10px; word-break: auto; width: 200px;"><p style="padding:5px;">'+text+'</p></div>';
  
   }
  </script>
</body>
